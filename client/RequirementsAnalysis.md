# 需求分析文档 --- 基于 Vue + TypeScript 的 Web 版贴吧系统

## 1. 前端功能实现

### 1.1 登录注册界面

- [ ] **1. 登录页面 UI**：包括用户名输入框、密码输入框、登录按钮、跳转注册链接  
- [ ] **2. 注册页面 UI**：包括用户名、邮箱、密码、确认密码输入框、注册按钮、邀请码（默认为10086）  
- [ ] **3. 输入验证**：检查字段是否为空、密码是否合法、两次密码是否一致、邀请码是否正确  
- [ ] **4. 前端错误提示**：在输入错误或接口返回错误时，显示错误信息  
- [ ] **5. 加载状态显示**：登录/注册中按钮禁用、显示加载动画  
- [ ] **6. 登录成功跳转**：登录成功后跳转到首页或用户主页  
- [ ] **7. 注册成功跳转**：注册成功后跳转到登录页并显示成功提示  
- [ ] **8. Token 存储（暂定）**：登录成功后保存后端返回的 token  
- [ ] **9. 自动登录/保持登录状态**：页面刷新时读取 token 并自动登录  
- [ ] **10. 退出登录**：点击退出按钮后清除 token 并跳转登录页  
- [ ] **11. 修改(忘记)密码**：通过发送邮箱到验证码进行密码的重置

### 1.2 首页界面

- [ ] **1. 侧边导航栏**：展示网站标题、导航菜单（首页 / 贴吧 / 我的 / 消息）  
- [ ] **2. 搜索栏**：用户可输入关键词搜索帖子标题、吧和用户  
- [ ] **3. 热门帖子、贴吧展示**：展示帖子标题、作者、时间、回复数、点赞数、所属贴吧等信息  
- [ ] **4. 帖子分页加载**：支持分页或无限滚动加载更多帖子  
- [ ] **5. 帖子点击跳转**：点击帖子标题进入帖子详情页 `/post/:postId`  
- [ ] **6. 置顶/公告模块**：在列表上方展示官方公告或置顶帖  
- [ ] **7. 发帖入口按钮**：登录用户可点击“发帖”按钮跳转到发帖页 `/post/create`  
- [ ] **8. 登录状态显示**：若已登录，显示用户头像与昵称；未登录则显示“登录/注册”按钮  
- [ ] **9. 排序/筛选功能**：支持按时间、热度、回复数等排序  
- [ ] **10. 响应式布局（暂定）**：首页在手机端与桌面端均能正常显示  

### 1.3 贴吧界面（我关注的吧）

- [ ] **1. 页面加载**：登录后从后端获取用户关注的贴吧列表  
- [ ] **2. 贴吧卡片展示**：显示每个贴吧的头像、名称、简介、粉丝数、帖子数等  
- [ ] **3. 进入贴吧**：点击卡片跳转至 `/forum/:forumId`  
- [ ] **4. 取消关注按钮**：每个卡片提供“已关注/取消关注”按钮  
- [ ] **5. 加载状态 / 空页面**：当未关注任何贴吧时显示提示（例如“你还没有关注任何贴吧”）  
- [ ] **6. 推荐贴吧模块**：推荐用户可能感兴趣的贴吧，点击即可关注  
- [ ] **7. 分页 / 无限滚动**：若关注贴吧较多，分页加载  

### 1.4 消息界面

- [ ] **1. 回复通知**：展示别人回复了用户的帖子或评论  
- [ ] **2. 点赞通知**：展示有人点赞了你的帖子或评论  
- [ ] **3. 私信功能**：用户之间的单独聊天窗口  
- [ ] **4. 系统通知**：官方发布的公告或警告信息  
- [ ] **5. 未读消息计数**：在导航栏显示未读消息数（例如红点提醒）  
- [ ] **6. 一键已读**：用户可以一键清空所有未读消息  
- [ ] **7. @我的通知**：展示有人 @ 了你  

### 1.5 “我的”界面

- [ ] **1. 个人资料**：显示用户头像、昵称、性别、签名、UID
- [ ] **2. 内容管理**：展示我发布的帖子和我的回复
- [ ] **3. 我的收藏**：展示我收藏的帖子
- [ ] **4. 我的关注和粉丝**：展示我关注的人和关注我的人（可取关和回关）
- [ ] **5. 个人资料编辑**：修改昵称、头像、签名、性别等
- [ ] **6. 隐私设置**：是否展示关注、粉丝、动态
- [ ] **7. 退出登录**

### 1.6 贴吧主页面

- [ ] **1. 贴吧信息展示**：显示贴吧名称、头像、简介、关注人数、帖子总数等基础信息  
- [ ] **2. 关注/取消关注功能**：登录用户可点击按钮关注或取消关注该贴吧  
- [ ] **3. 贴吧公告栏**：展示吧主发布的公告或置顶内容  
- [ ] **4. 帖子列表展示**：按时间或热度显示帖子，每一份帖子卡片包含标题、作者、发布时间、回复数，部分内容等  
- [ ] **5. 帖子分页 / 无限滚动**：向下滑动加载更多帖子  
- [ ] **6. 帖子点击跳转**：点击帖子标题进入帖子详情页 `/forum/:forumId/post/:postId`  
- [ ] **7. 发帖入口**：已登录用户可点击“发帖”按钮进入发帖页面 `/post/create`  
- [ ] **8. 搜索功能**：支持搜索贴吧内的帖子标题
- [ ] **9. 排序筛选功能**：支持按时间、热度、回复数进行排序  
  - [ ] **10. 吧务管理入口（仅限吧主）**：支持删除帖子、置顶帖子等管理操作  

- [ ] **11. 精华帖模块（可选）**：展示被设为精华的帖子  
- [ ] **12. 用户交互功能**：支持点赞、收藏帖子  
- [ ] **13. 加载状态与空页面**：当没有帖子时显示提示“暂无帖子”  
- [ ] **14. 响应式布局（暂定）**：适配移动端与桌面端浏览体验 

### 1.7 帖子主页面

- [ ] **1. 帖子信息展示**：显示帖子标题、作者昵称与头像、发布时间、所属贴吧、点赞数、收藏数等  
- [ ] **2. 帖子内容展示**：支持文字、图片（暂定）等多种格式的帖子内容显示  
- [ ] **3. 作者操作区**：若为本人帖子，显示“编辑”“删除”按钮  
- [ ] **4. 点赞 / 收藏功能**：用户可点赞帖子或收藏帖子  
- [ ] **5. 回复列表展示**：展示所有一级回复，按时间或热度排序  
- [ ] **6. 回复功能**：用户可输入内容回复帖子  
- [ ] **7. 楼中楼（子回复）功能**：支持在评论下继续回复，实现楼中楼结构展示  
- [ ] **8. 回复分页加载**：当回复数量过多时分页或滚动加载  
- [ ] **9. 回复计数与楼层标识**：显示每条回复的楼层号与总回复数  
- [ ] **10. 点赞评论**：用户可点赞其他用户的评论  
- [ ] **11. @功能**：在回复中支持 @ 其他用户，并触发消息通知  
- [ ] **12. 管理操作入口（吧务/管理员）**：显示“删除”“置顶”“屏蔽”等后台管理操作  
- [ ] **13. 加载状态与错误处理**：加载中、加载失败、评论为空等状态提示  
- [ ] **14. 返回导航**：可返回上级贴吧页 `/forum/:forumId`  
- [ ] **15. 响应式布局（暂定）**：适配移动端与桌面端显示  

### 1.8 发帖页面

- [ ] **1. 页面入口**：从首页或贴吧页面点击“发帖”按钮跳转至 `/post/create`  
- [ ] **2. 选择所属贴吧**：若从首页进入，需选择要发帖的贴吧；若从某贴吧进入，自动填充该贴吧  
- [ ] **3. 帖子标题输入框**：输入标题（限制字数，如 5–100 字），为空时禁止提交  
- [ ] **4. 帖子内容编辑器**：支持富文本输入：文字、图片（暂定）  
- [ ] **5. 图片上传功能（可选）**：用户可上传图片至帖子内容中（单图或多图）  
- [ ] **6. 内容预览功能（可选）**：提供预览按钮查看最终帖子效果  
- [ ] **7. 选择标签/分类（可选）**：支持选择帖子标签（如“讨论”“问答”“资源分享”）  
- [ ] **8. 发帖按钮**：提交帖子内容至后端接口 
- [ ] **9. 发帖加载状态**：发帖过程中禁用按钮并显示“发布中…”加载提示  
- [ ] **10. 发帖成功提示**：显示“发布成功”，并跳转至新帖子详情页 `/post/:postId`  
- [ ] **11. 发帖失败处理**：显示错误提示（例如：标题为空、内容过短、网络异常）  
- [ ] **12. 草稿保存（可选）**：编辑时自动保存草稿至 `localStorage`，支持下次继续编辑  
- [ ] **13. 登录验证**：未登录用户点击“发帖”时自动跳转登录页  
- [ ] **14. 响应式布局（暂定）**：适配手机端与桌面端发帖界面  

## 2. 后端功能实现

### 2.1 用户验证

| 接口              | 方法 | 请求体                                                       | 响应体                                                       | 说明                                |
| ----------------- | ---- | ------------------------------------------------------------ | ------------------------------------------------------------ | ----------------------------------- |
| `/get_varifycode` | POST | `{"email": "user@example.com"}`                              | `{"error": 0, "email": "user@example.com"}`                  | 生成并发送验证码，存入 Redis        |
| `/user_register`  | POST | `{"email": "", "user": "", "passwd": "", "confirm": "", "icon": "", "varifycode": "", "invite_code": "10086"}` | `{"error": 0, "uid": 1059, "user": "", "email": ""}`         | 注册用户，校验验证码和邀请码        |
| `/user_login`     | POST | `{"email": "", "passwd": ""}`                                | `{"error": 0, "email": "", "uid": 1054, "token": "...", "host": "127.0.0.1", "port": "8090"}` | 登录，分配 ChatServer 节点          |
| `/reset_pwd`      | POST | `{"email": "", "user": "", "passwd": "", "varifycode": ""}`  | `{"error": 0, "email": "", "user": ""}`                      | 重置修改密码                        |
| `/update_profile` | POST | `{"uid": 1054, "nickname": "", "icon": "", "sex": 0, "desc": ""}` | `{"error": 0}`                                               | 更新用户资料，需验证 token          |
| `/logout`         | POST | `{"uid": 1054, "token": "..."}`                              | `{"error": 0}`                                               | 退出登录，清除 Redis `utoken_<uid>` |
| `/get_profile`    | GET  | `?uid=1054`                                                  | `{"error": 0, "uid": 1054, "name": "", "nick": "", "icon": "", "sex": 0, "desc": ""}` | 获取用户资料                        |

### 2.2 贴吧管理

| 接口               | 方法 | 请求体/参数                    | 响应体                                                       | 说明                   |
| ------------------ | ---- | ------------------------------ | ------------------------------------------------------------ | ---------------------- |
| `/forums`          | GET  | `?page=1&limit=20`             | `{"error": 0, "forums": [{ "forum_id": 1, "name": "", "avatar": "", "description": "", "follower_count": 100, "post_count": 50 }]}` | 获取贴吧列表（分页）   |
| `/forum/:forum_id` | GET  |                                | `{"error": 0, "forum": { "forum_id": 1, "name": "", "avatar": "", "description": "", "follower_count": 100, "post_count": 50, "is_followed": true }}` | 获取贴吧详情           |
| `/follow_forum`    | POST | `{"uid": 1054, "forum_id": 1}` | `{"error": 0}`                                               | 关注贴吧，需验证 token |
| `/unfollow_forum`  | POST | `{"uid": 1054, "forum_id": 1}` | `{"error": 0}`                                               | 取消关注贴吧           |
| `/followed_forums` | GET  | `?uid=1054&page=1&limit=20`    | `{"error": 0, "forums": [{ "forum_id": 1, ... }]}`           | 获取用户关注的贴吧列表 |

### 2.3 帖子管理

| 接口                | 方法   | 请求体/参数                                                  | 响应体                                                       |                    说明                    |
| ------------------- | ------ | ------------------------------------------------------------ | ------------------------------------------------------------ | :----------------------------------------: |
| `/posts`            | GET    | `?forum_id=1&page=1&limit=20&sort=time`                      | `{"error": 0, "posts": [{ "post_id": 456, "title": "", "uid": 1054, "author": "", "created_at": "", "reply_count": 10, "like_count": 5, "is_top": false, "is_essence": false, "content_preview": "" }]}` | 获取帖子列表（支持排序：time, hot, reply） |
| `/post/:post_id`    | GET    | -                                                            | `{"error": 0, "post": { "post_id": 456, "title": "", "content": "", "uid": 1054, "author": "", "created_at": "", "forum_id": 1, "like_count": 5, "is_liked": false, "is_collected": false }}` |                获取帖子详情                |
| `/post`             | POST   | `{"uid": 1054, "forum_id": 1, "title": "", "content": "", }` | `{"error": 0, "post_id": 456}`                               |           创建帖子，需验证 token           |
| `/post/:post_id`    | PUT    | `{"uid": 1054, "title": "", "content": ""}`                  | `{"error": 0}`                                               |            编辑帖子（仅限作者）            |
| `/post/:post_id`    | DELETE | `{"uid": 1054}`                                              | `{"error": 0}`                                               |           删除帖子（作者或吧主）           |
| `/like_post`        | POST   | `{"uid": 1054, "post_id": 456}`                              | `{"error": 0}`                                               |                  点赞帖子                  |
| `/unlike_post`      | POST   | `{"uid": 1054, "post_id": 456}`                              | `{"error": 0}`                                               |                  取消点赞                  |
| `/collect_post`     | POST   | `{"uid": 1054, "post_id": 456}`                              | `{"error": 0}`                                               |                  收藏帖子                  |
| `/uncollect_post`   | POST   | `{"uid": 1054, "post_id": 456}`                              | `{"error": 0}`                                               |                  取消收藏                  |
| `/set_top_post`     | POST   | `{"uid": 1054, "post_id": 456, "is_top": true}`              | `{"error": 0}`                                               |         设置/取消置顶（吧主权限）          |
| `/set_essence_post` | POST   | `{"uid": 1054, "post_id": 456, "is_essence": true}`          | `{"error": 0}`                                               |         设置/取消精华（吧主权限）          |

### 2.4 回复管理

| 接口                     | 方法   | 请求体/参数                                                  | 响应体                                                       | 说明                              |
| ------------------------ | ------ | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------- |
| `/post/:post_id/replies` | GET    | `?page=1&limit=20&sort=time`                                 | `{"error": 0, "replies": [{ "reply_id": 789, "post_id": 456, "uid": 1054, "content": "", "parent_reply_id": 0, "created_at": "", "floor": 1, "like_count": 2, "is_liked": false, "sub_replies": [...] }]}` | 获取回复列表（支持楼中楼）        |
| `/reply`                 | POST   | `{"uid": 1054, "post_id": 456, "content": "", "parent_reply_id": 0, "at_uids": [1055]}` | `{"error": 0, "reply_id": 789}`                              | 创建回复，`at_uids` 表示 @ 的用户 |
| `/reply/:reply_id`       | DELETE | `{"uid": 1054}`                                              | `{"error": 0}`                                               | 删除回复（作者或吧主）            |
| `/like_reply`            | POST   | `{"uid": 1054, "reply_id": 789}`                             | `{"error": 0}`                                               | 点赞回复                          |
| `/unlike_reply`          | POST   | `{"uid": 1054, "reply_id": 789}`                             | `{"error": 0}`                                               | 取消点赞                          |

### 2.5 搜索功能

| 接口      | 方法 | 请求体/参数                                         | 响应体                                                       | 说明                                                      |
| --------- | ---- | --------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------------------------- |
| `/search` | GET  | `?keyword=xxx&type=post&forum_id=1&page=1&limit=20` | `{"error": 0, "results": [{ "post_id": 456, ... } or { "forum_id": 1, ... } or { "uid": 1054, ... }]}` | 搜索帖子、贴吧或用户，`type` 可选 `post`、`forum`、`user` |

### 2.6 用户内容管理

| 接口            | 方法 | 请求体/参数               | 响应体                                              | 说明               |
| --------------- | ---- | ------------------------- | --------------------------------------------------- | ------------------ |
| /my/posts       | GET  | ?uid=1054&page=1&limit=20 | {"error": 0, "posts": [{ "post_id": 456, ... }]}    | 获取用户发布的帖子 |
| /my/replies     | GET  | ?uid=1054&page=1&limit=20 | {"error": 0, "replies": [{ "reply_id": 789, ... }]} | 获取用户回复       |
| /my/collections | GET  | ?uid=1054&page=1&limit=20 | {"error": 0, "posts": [{ "post_id": 456, ... }]}    | 获取用户收藏的帖子 |
| /my/followers   | GET  | ?uid=1054&page=1&limit=20 | {"error": 0, "users": [{ "uid": 1055, ... }]}       | 获取粉丝列表       |
| /my/following   | GET  | ?uid=1054&page=1&limit=20 | {"error": 0, "users": [{ "uid": 1055, ... }]}       | 获取关注列表       |